{% block collection_form %}
{{ form_start(collectionForm, { 'attr': { 'enctype': 'multipart/form-data' }}) }}
    <div class="modal fade" id="assetCheckinSelectStorageModal" data-bs-backdrop="static" data-bs-keyword="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <div id="stepper">
                        <span class="stepIndicator active">Select Storage</span>
                        <span class="stepIndicator">Select User</span>
                        <span class="stepIndicator">Select Asset</span>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h2 class="font-normal">Select Storage</h2>
                    <div class="mt-3 input-storage">
                        <label for="form_storageId" class="form-label">Select Storage Unit</label>
                        {{ form_widget(collectionForm.storageId, { 'attr': { 'id': 'form_storage', 'class': 'form-select' } }) }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" data-bs-target="#assetCheckinSelectUsersModal" data-bs-toggle="modal">Select Storage</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="assetCheckinSelectUsersModal" data-bs-backdrop="static" data-bs-keyword="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <div id="stepper">
                        <span class="stepIndicator">Select Storage</span>
                        <span class="stepIndicator active">Select User</span>
                        <span class="stepIndicator">Select Asset</span>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="selectUserBody">
                    <h2 class="font-normal">User Assignment</h2>
                    <div class="mt-3 input-user">
                        <label for="form_assigned_to" class="form-label">Assign User</label>
                        {{ form_widget(collectionForm.assigned_to, { 'attr': { 'style': 'width:100%' } }) }}
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-target="#assetCheckinSelectStorageModal" data-bs-toggle="modal">Previous</button>
                    {# There is a bug here. If this is a button and both asset_tag and serial_number are not required, this will auto submit the form #}
                    <a role="button" class="btn btn-primary" data-bs-target="#assetCheckinSelectAssetModal" data-bs-toggle="modal">Select User</a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="assetCheckinSelectAssetModal" data-bs-backdrop="static" data-bs-keyword="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <div id="stepper">
                        <span class="stepIndicator">Select Storage</span>
                        <span class="stepIndicator">Select User</span>
                        <span class="stepIndicator active">Select Asset</span>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h2 class="font-normal">Asset Collection</h2>
                    <!-- Step 3 input fields -->
                    <div class="mt-3">
                        <div class="form-floating mb-3">
                            {{ form_widget(collectionForm.asset_tag, { 'attr': { 'id': 'form_asset_tag', 'class': 'form-control' } }) }}
                            <label for="form_asset_tag">Asset Tag</label>
                        </div>
                        <div class="form-floating">
                            {{ form_widget(collectionForm.asset_serial, { 'attr': { 'id': 'form_asset_serial', 'class': 'form-control' } }) }}
                            <label for="form_asset_serial">Asset Serial</label>
                        </div>
                        {# make, model #}
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-target="#assetCheckinSelectUsersModal" data-bs-toggle="modal" data-bs-dismiss="modal">Previous</button>
                    {{ form_widget(collectionForm.Collect) }}
                </div>
            </div>
        </div>
    </div>
{{ form_end(collectionForm) }}
    {{ encore_entry_script_tags('app') }}
    <script type="text/javascript">
        {# Asset Collection Modal #}
        $(document).ready(function() {
            /**
             * Select2 Configuration
             */
            $.fn.modal.Constructor.prototype.enforceFocus = function() {};
            $('#form_assigned_to').select2({
                dropdownParent: $('#assetCheckinSelectUsersModal'),
                placeholder: 'Select a user',
                theme: 'bootstrap-5',
            });

            $('#assetCheckinSelectUsersModal').on('shown.bs.modal', () => {
                $('#form_assigned_to').on('change', function() {
                    $('#btnSelectAssetModal').removeAttr("disabled");
                });
            });
        });
    </script>
{% endblock %}
