{% extends 'base.html.twig' %}

{% block body %}
    {# Checkout buttons #}
    <div class="mb-4 bg-dark rounded p-1 border">
        <a href="{{ path('app_asset_distribution') }}" class="btn btn-app">
            <i class="fas fa-right-from-bracket"></i>
            Distribute Asset
        </a>
        <a href="{{ path('app_distribute_revoke') }}" class="btn btn-app">
            <i class="fas fa-rectangle-list"></i>
            Distribution History/Revoke
        </a>
        <a href="{{ path('app_asset_distribution_roulette') }}" class="btn btn-app">
            <i class="fas fa-diagram-next"></i>
            Roulette
        </a>
    </div>
    {# End checkout buttons #}

    <div class="dataTables_wrapper dt-bootstrap5 container-fluid">
        <table id="assetTable" class="table table-bordered table-hover table-striped dataTable" aria-describedby="assetTable_info" style="width:100%;">
            <thead>
            <tr>
                <th class="all">Location</th>
                <th class="all">Asset Tag</th>
                <th class="all">Serial Number</th>
                <th class="all">User ID</th>
                <th class="all">Last Name</th>
                <th class="all">First Name</th>
                <th class="all" id="notesColumn">Notes</th>
                <th class="all">Distribute</th>
            </tr>
            </thead>
            <tbody>
                {% for asset in collectedAssets %}
                    <tr{% if asset.sentToDistribution is defined %} class="sentToDistribution"{% endif %}>
                        <form method="post" action="{{ path('app_distribute_handle') }}">
                            <input type="hidden" name="assetId" value="{{ asset.id }}" />
                            <input type="hidden" name="userId" value="{{ asset.userId }}" />
                            <input type="hidden" name="location" value="{{ asset.location }}" />
                            <td class="text-center">{{ asset.location }}</td>
                            <td class="text-center">{{ asset.assetTag }}</td>
                            <td class="text-center">{{ asset.serialNumber }}</td>
                            <td class="text-center">{{ asset.userUniqueIdentifier }}</td>
                            <td class="text-center">{{ asset.userSurname }}</td>
                            <td class="text-center">{{ asset.userFirstName }}</td>
                            <td class="text-center align-middle">
                                <div id="button-wrapper">
                                    <a role="button" data-toggle="collapse" data-target="#note-field-{{ asset.id }}" id="button" class="btn btn-sm btn-outline-light{% if asset.sentToDistribution is defined %} disabled{% endif %}">Set a note</a>
                                </div>
                                <div id="note-field-{{ asset.id }}" class="collapse note-field" style="width:240px;">
                                    <input type="text" id="notes" name="note" class="form-control" />
                                </div>
                            </td>
                            <td class="text-center"><button type="submit" class="btn btn-sm btn-outline-secondary{% if asset.sentToDistribution is defined %} disabled{% endif %}">Distribute</button></td>
                        </form>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .sentToDistribution {
            background-color: #ff9c9c !important;
        }
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('datatables') }}
    <script type="text/javascript">
        $(document).ready(function() {
            // Set the DataTable
            var table = $('#assetTable').DataTable({
                scrollX: true,
                scrollCollapse: true,
                scrollY: '68vh',
                paging: true,
                pagingType: "numbers",
                lengthChange: true,
                iDisplayLength: 25,
                searching: true,
                ordering: true,
                processing: true,
                columnDefs: [
                    {orderable: false, targets: 6}
                ],
                info: true,
                autoWidth: true,
                responsive: true,
                autoFill: true,
                stateSave: true,
                colReorder: true,
                lengthMenu: [
                    [10, 25, 50, -1],
                    [10, 25, 50, 'All']
                ],
            });

            // $('.dataTables_filter input[type="search"]').css(
            //     {'width': '350px', 'display': 'inline-block'}
            // );

            $('.dataTables_filter input').focus();

            $('.dataTables_filter input[type="search"]').
                attr('placeholder', 'Search assets ....').
                css({'width': '350px', 'display': 'inline-block'});

            $('button.disabled').attr('disabled', true);

            $('#button-wrapper a').click(function() {
                $(this).hide();
            })

            // TODO: Change back to button when unfocused
            // $('#button-wrapper a').focusout(function() {
            //     $('.note-field').collapse();
            //     $(this).show();
            // })
        });
    </script>
{% endblock %}
{% block optional_javascript %}{% endblock %}
